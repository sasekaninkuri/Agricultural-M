{% extends "base.html" %}
{% set active_page = "dashboard" %}

{% block title %}Dashboard | Glit & Glamour{% endblock %}

{% block head %}
  <!-- Google Charts -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load("current", { packages: ['corechart', 'bar'] });
    google.charts.setOnLoadCallback(drawCharts);

    function drawCharts() {
      // Bookings Overview Chart
      var totalBookings = {{ stats.bookings.total }};
      var data1 = google.visualization.arrayToDataTable([
      ["Metric", "Count", { role: "style" }],
      ["Total Bookings", totalBookings, "#B76E79"],
      ["Completed", Math.floor(totalBookings * 0.8), "#2C2C2C"],
      ["Upcoming", Math.floor(totalBookings * 0.2), "#E6BE8A"]
    ]);
    var chart1 = new google.visualization.ColumnChart(document.getElementById("columnchart_values"));
    chart1.draw(data1, { title: "Booking Activity", height: 300, legend: 'none', chartArea: { width: '80%' } });

    // Finance Overview
    var totalRevenue = {{ stats.finance.total }};
    var data2 = google.visualization.arrayToDataTable([
      ['Category', 'Amount'],
      ['Revenue', totalRevenue],
      ['Pending', totalRevenue * 0.1]
    ]);
    var chart2 = new google.visualization.PieChart(document.getElementById('piechart'));
    chart2.draw(data2, { title: 'Financial Overview (ZAR)', height: 300, colors: ['#B76E79', '#E6BE8A'] });

    // Client Demographics
    var femaleCount = {{ stats.clients.female }};
    var maleCount = {{ stats.clients.male }};
    var otherCount = {{ stats.clients.other }};

    var data3 = google.visualization.arrayToDataTable([
      ['Gender', 'Count'],
      ['Female', femaleCount],
      ['Male', maleCount]
        {% if stats.clients.other > 0 %}, ['Other', otherCount]{% endif %}
      ]);
    var chart3 = new google.visualization.PieChart(document.getElementById('donutchart'));
    chart3.draw(data3, { title: 'Client Demographics', pieHole: 0.4, height: 300, colors: ['#B76E79', '#E6BE8A', '#2C2C2C'] });

    // Weekly Activity Pattern
    var data4 = google.visualization.arrayToDataTable([
      ['Day', 'Bookings'],
      ["Mon", Math.floor(totalBookings * 0.12)],
      ["Tue", Math.floor(totalBookings * 0.15)],
      ["Wed", Math.floor(totalBookings * 0.18)],
      ["Thu", Math.floor(totalBookings * 0.16)],
      ["Fri", Math.floor(totalBookings * 0.20)],
      ['Sat', Math.floor(totalBookings * 0.19)]
    ]);
    var chart4 = new google.charts.Bar(document.getElementById('top_x_div'));
    chart4.draw(data4, google.charts.Bar.convertOptions({
      title: 'Weekly Activity Pattern',
      height: 300,
      colors: ['#B76E79']
    }));
    }
  </script>
{% endblock %}

{% block content %}
  <h1>Dashboard</h1>
  <p class="overview-text">Welcome back, <strong>{{ session.get('user', 'Salon Admin') }}</strong>. Here's your
    salon's performance overview.</p>

  <div class="dashboard-grid">
    <div class="chart-card" id="columnchart_values"></div>
    <div class="chart-card" id="piechart"></div>
    <div class="chart-card" id="donutchart"></div>
    <div class="chart-card" id="top_x_div"></div>
  </div>

  <div class="card-appoint">
    <h3>Our Team / Staffing</h3>
    <div class="staff-list">
      <a href="{{ url_for('management.get_staff') }}"><button class="staff-btn">Barber Team</button></a>
      <a href="{{ url_for('management.get_staff') }}"><button class="staff-btn">Senior Stylists</button></a>
      <a href="{{ url_for('management.get_staff') }}"><button class="staff-btn">Nail Technicians</button></a>
      <a href="{{ url_for('management.get_staff') }}"><button class="staff-btn">Makeup Artists</button></a>
    </div>
  </div>
{% endblock %}
